(()=>{"use strict";const e=window.React,t=window.wp.element,n=window.wp.i18n,s=window.wp.htmlEntities,a=window.wc.wcBlocksRegistry,r=window.wc.wcSettings,l=window.wc.wcBlocksData,c=(0,r.getSetting)("omise_installment_data",{}),o=(0,s.decodeEntities)(c.title)||"No title set",{select:i,subscribe:u}=window.wp.data,m=a=>{const{eventRegistration:r,emitResponse:o}=a,{onPaymentSetup:m,onCheckoutValidation:w,onCheckoutFail:d}=r,p=(0,s.decodeEntities)(c.description||""),{installments_enabled:E,public_key:R}=c.data,_=(0,n.__)("Purchase Amount is lower than the monthly minimum payment amount.","omise"),f=(0,t.useRef)(null),y=(0,t.useRef)(null),h=(0,t.useRef)(null),C=(0,t.useRef)(null),T=()=>{if(E){const e=i(l.CART_STORE_KEY).getCartData();C.current=e.totals.total_price;let t=c.locale.toLowerCase();t=["en","th","ja"].includes(t)?t:"en",f.current.innerHTML="",showOmiseInstallmentForm({element:f.current,publicKey:R,amount:C.current,locale:t,onSuccess:e=>{y.current=e},onError:e=>{h.current=e}})}},g=()=>{const e=i(l.CART_STORE_KEY).getCartData();C.current=e.totals.total_price,T()};return(0,t.useEffect)((()=>u(g,l.CART_STORE_KEY)),[l.CART_STORE_KEY]),(0,t.useEffect)((()=>{T()}),[E]),(0,t.useEffect)((()=>w((()=>(OmiseCard.requestCardToken(),!0)))),[w]),(0,t.useEffect)((()=>d((()=>(y.current=null,T(),!0)))),[d]),(0,t.useEffect)((()=>{const e=m((async()=>await new Promise(((e,t)=>{const n=setInterval((()=>{if(y.current){clearInterval(n);try{const t={type:o.responseTypes.SUCCESS,meta:{paymentMethodData:{omise_source:y.current.source,omise_token:y.current.token}}};e(t)}catch(e){clearInterval(n);const s={type:o.responseTypes.ERROR,message:e.message};t(s)}}}),1e3)}))));return()=>e()}),[m]),(0,e.createElement)(e.Fragment,null,p&&(0,e.createElement)("p",null,p),E?(0,e.createElement)("div",{ref:f,id:"omise-installment",style:{width:"100%",maxWidth:"400px"}}):(0,e.createElement)("p",null,_))};(0,a.registerPaymentMethod)({name:c.name||"",label:(0,e.createElement)((t=>{const{PaymentMethodLabel:n}=t.components;return(0,e.createElement)(n,{text:o})}),null),content:(0,e.createElement)(m,null),edit:(0,e.createElement)(m,null),canMakePayment:()=>c.is_active,ariaLabel:o,supports:{features:c.supports}})})();